###############################################################################
[machine]

# Machine-specific directories. This section is optional, and is used here to
# group machine specific paths. Ideally, only this section entries would need
# to be changed when this experiment is to be run on another machine.
omp_dir = /usr/lib/x86_64-linux-gnu/openmpi
netcdf_lib = /usr/lib/x86_64-linux-gnu/
netcdf_inc = /usr/include/
MOM6_tuning_dir = /root/MOM6-tuning
fms_rose_build_dir = ${MOM6_tuning_dir}/build/rose/shared/debug/
mom6_rose_build_dir = ${MOM6_tuning_dir}/build/rose/ocean_only/debug/
  
###############################################################################
[target]

# target file path:
entrypoint = ${machine:MOM6_tuning_dir}/src/MOM6/src/core/MOM_continuity_PPM.F90

scope =  ::MOM_continuity_PPM::
##         ::MOM_continuity_PPM::zonal_mass_flux
##         ::MOM_continuity_PPM::zonal_flux_layer
##         ::MOM_continuity_PPM::zonal_face_thickness
##         ::MOM_continuity_PPM::zonal_flux_adjust
##         ::MOM_continuity_PPM::set_zonal_BT_cont
##         ::MOM_continuity_PPM::meridional_mass_flux
##         ::MOM_continuity_PPM::merid_flux_layer
##         ::MOM_continuity_PPM::merid_face_thickness
##         ::MOM_continuity_PPM::meridional_flux_adjust
##         ::MOM_continuity_PPM::set_merid_BT_cont
##         ::MOM_continuity_PPM::PPM_reconstruction_x
##         ::MOM_continuity_PPM::PPM_reconstruction_y
##         ::MOM_continuity_PPM::PPM_limit_pos
##         ::MOM_continuity_PPM::PPM_limit_CW84
##         ::MOM_continuity_PPM::ratio_max

# command to compile ROSE-specific dependencies, i.e., rmod files
build_rose_depends_cmd = ./docker/build_MOM6_ROSE_depends.sh MOM6

rose_depends_dir = ${machine:mom6_rose_build_dir}

# additional compiler flags to be specified when Precimonious plugin is run on the target file
aux_plugin_flags = -Duse_libMPI -Duse_netCDF -DSPMD -Duse_LARGEFILE -fcray-pointer -fdefault-double-8 
  -fdefault-real-8 -Waliasing -ffree-line-length-none -fno-range-check -DOVERLOAD_R8 -DOVERLOAD_R4
  -DROSEPREP -I${machine:omp_dir}/include -pthread -I${machine:omp_dir}/lib -Wl,-rpath 
  -Wl,${machine:omp_dir}/lib -Wl,--enable-new-dtags -L${machine:omp_dir}/lib -lmpi_usempif08
  -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi  -lnetcdff -lnetcdf -L${machine:netcdf_lib}
  -I${machine:netcdf_inc} -Wl,-rpath,${machine:netcdf_inc} -O2 -fbounds-check 
  -I${machine:fms_rose_build_dir} -I${machine:MOM6_tuning_dir}/src/MOM6/config_src/dynamic 
  -I${machine:MOM6_tuning_dir}/src/MOM6/src/framework -I${machine:mom6_rose_build_dir} 


###############################################################################
[build]

# directory to build the application executable:
dir = ./

# command to build the application:
cmd = ./docker/build_MOM6_GNU_debug.sh MOM6

###############################################################################
[run]

# directory where the application gets run
dir = ./

# command to run the application
cmd = mpirun -np 8 --allow-run-as-root /root/MOM6-tuning/build/gnu/ocean_only/debug/MOM6
# TODO add command to save ocean.stats

# number of iterations:
iters = 1

###############################################################################
[eval]

dir = ./
cmd = python3 eval_MOM6_stats.py
pass_runout = False
